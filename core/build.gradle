plugins {
  id("org.jetbrains.kotlin.jvm")
  id("com.alecstrong.grammar.kit.composer")
}

apply from: "$rootDir/gradle/gradle-mvn-push.gradle"

grammarKit {
  intellijRelease.set(ideaVersion)
}

sourceSets {
  main.java.srcDir "gen"
}

dependencies {
  compileOnly intellijLang
  compileOnly intellijCore

  testImplementation intellijLang
  testImplementation intellijCore
  testImplementation junit
  testImplementation truth
}

generateLexer {
  source.set('src/main/kotlin/com/alecstrong/sql/psi/core/SqlLexer.flex')
  targetDir.set('gen/com/alecstrong/sql/psi/core/lexer/')
  targetClass.set('SqlLexer')
  purgeOldFiles.set(true)
}

compileKotlin.dependsOn generateLexer
dokkaHtml.dependsOn generateLexer
